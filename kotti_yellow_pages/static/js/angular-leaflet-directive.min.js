(function(){var a=angular.module("leaflet-directive",[]);a.directive("leaflet",function(c,b){return{restrict:"E",replace:true,transclude:true,scope:{center:"=center",marker:"=marker",message:"=message",zoom:"=zoom",multiMarkers:"=multimarkers"},template:'<div class="map"></div>',link:function(i,h,f,j){var g=h[0],k=new L.Map(g);L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:12}).addTo(k);var d=new L.LatLng(40.094882122321145,-3.8232421874999996);k.setView(d,5);i.$watch("center",function(l){if(l===undefined){return}l=new L.LatLng(i.center.lat,i.center.lng);var p=i.zoom||8;k.setView(l,p);var m=new L.marker(i.center,{draggable:f.markcenter?false:true});if(f.markcenter||f.marker){k.addLayer(m);if(f.marker){i.marker.lat=m.getLatLng().lat;i.marker.lng=m.getLatLng().lng}i.$watch("message",function(q){m.bindPopup("<strong>"+q+"</strong>",{closeButton:false});m.openPopup()})}var n=false;k.on("dragstart",function(q){n=true});k.on("drag",function(q){i.$apply(function(r){r.center.lat=k.getCenter().lat;r.center.lng=k.getCenter().lng})});k.on("dragend",function(q){n=false});i.$watch("center.lng",function(r,q){if(n){return}k.setView(new L.LatLng(k.getCenter().lat,r),k.getZoom())});i.$watch("center.lat",function(r,q){if(n){return}k.setView(new L.LatLng(r,k.getCenter().lng),k.getZoom())});i.$watch("zoom",function(r,q){k.setZoom(r)});k.on("zoomend",function(q){i.$apply(function(r){r.zoom=k.getZoom()})});if(f.marker){var o=false;(function(){m.on("dragstart",function(q){o=true});m.on("drag",function(q){i.$apply(function(r){r.marker.lat=m.getLatLng().lat;r.marker.lng=m.getLatLng().lng})});m.on("dragend",function(q){m.openPopup();o=false});k.on("click",function(q){m.setLatLng(q.latlng);m.openPopup();i.$apply(function(r){r.marker.lat=m.getLatLng().lat;r.marker.lng=m.getLatLng().lng})});i.$watch("marker.lng",function(r,q){if(o){return}m.setLatLng(new L.LatLng(m.getLatLng().lat,r))});i.$watch("marker.lat",function(r,q){if(o){return}m.setLatLng(new L.LatLng(r,m.getLatLng().lng))})}())}});if(f.multimarkers){var e=[];i.$watch("multiMarkers",function(m){for(var l in i.multiMarkers){(function(p){var o=i.multiMarkers[p];var n=new L.marker(i.multiMarkers[p],{draggable:o.draggable?true:false});n.on("dragstart",function(q){dragging_marker=true});n.on("drag",function(q){i.$apply(function(r){o.lat=n.getLatLng().lat;o.lng=n.getLatLng().lng})});n.on("dragend",function(q){dragging_marker=false});i.$watch("multiMarkers."+p,function(){n.setLatLng(i.multiMarkers[p])},true);k.addLayer(n);e[p]=n})(l)}})}}}})}());