var CompanyEditCtrl;CompanyEditCtrl=function(b,e,c,d){var a;$(".spinner").spin({});b.location=new L.LatLng(0,0);b.map=d;b.map.setView(b.location,6);b.marker=L.marker(b.location,{draggable:true}).addTo(b.map);b.search={status:"notAllowed"};b.browserSupportsGeolocation=navigator.geolocation;b.invokeNavigatorGeoLocation=function(){if(navigator.geolocation){return navigator.geolocation.getCurrentPosition(function(f){b.company.location.lat=f.coords.latitude;b.company.location.lng=f.coords.longitude;return b.setMarkerFromLocation()})}};b.selectSearchResult=function(f){var g;g=f.latLng;g=new L.LatLng(g.lat,g.lng);b.company.location.lat=g.lat;b.company.location.lng=g.lng;b.setMarkerFromLocation();return b.search.status="singleResult"};b.locateAddress=function(){if(!b.addressSubform.$valid){return false}c.info("Updating location from scope.address...");b.search.results=[];b.search.status="inProgress";b.communicationSubform.$setPristine();d.latLngForAddress(b.company.address).then(function(g){var f;b.searchInProgress=false;if(g.length!==1){c.warn("response.data contains "+g.length+" results.");b.search.status="noResult";return false}f=g[0].locations;switch(f.length){case 0:c.warn("results[0] contains "+f.length+" locations.");b.search.status="noResult";return false;case 1:b.search.status="singleResult";b.selectSearchResult(f[0]);return true;default:b.search.status="multipleResults";b.search.results=f;return false}});return false};b.setMarkerFromLocation=function(){c.info("Updating marker position and form field values from scope.location...");b.marker.setLatLng(b.company.location);b.map.panTo(b.company.location);b.map.setZoom(14);return true};b.marker.on("dragend",function(f){return b.$apply(function(){b.company.location.lat=f.target._latlng.lat;return b.company.location.lng=f.target._latlng.lng})});a=function(){var f;c.info("handleLocationChange");f=b.company.location;if(!(f&&f.lat&&f.lng)){return false}if(!L.LatLng.isPrototypeOf(b.company.location)){b.company.location=new L.LatLng(f.lat,f.lng)}return b.setMarkerFromLocation()};b.$watch("company.location.lat",a,false);return b.$watch("company.location.lng",a,false)};