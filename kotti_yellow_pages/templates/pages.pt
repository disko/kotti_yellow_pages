<!DOCTYPE html>
<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="api.macro('kotti:templates/view/master.pt')"
      i18n:domain="kotti_yellow_pages">

  <more metal:fill-slot="head-more">
    <script>window.context_url = '${request.resource_url(context)}';</script>
  </more>
  <article metal:fill-slot="content" class="yp-pages view ng-cloak"
           ng-app="kotti_yellow_pages" ng-controller="PagesCtrl"
           ng-init="branches = ${branches_json}; companies = ${companies_json};">
    <h1>${context.title}</h1>
    <p class="description">
      ${context.description}
    </p>
    <p i18n:translate="" ng-hide="companies">
      No companies yet.
    </p>

    <form class="form form-vertical row">
      <div class="span6">
        <label class="control-label" i18n:translate="">Ich suche...</label>
        <div class="control-group">
          <div class="controls">
            <div ng-repeat="branch in branches">
              <input type="checkbox" ng-model="branch.visible"
                ng-change="updateBranchesVisible()" /> {{ branch.title }}
            </div>
          </div>
        </div>
      </div>
      <div class="span6">
        <div class="control-group">
          <label class="control-label" i18n:translate="">in der NÃ¤he von</label>
          <div class="controls">
            <input type="text" placeholder="PLZ" ng-model="user.zipcode" />
          </div>
        </div>
      </div>
    </form>

    <form class="form-vertical row hide" ng-show="companies">
      <div class="control-group span6">
        <label class="control-label" i18n:translate="">Sort by</label>
        <div class="controls">
          <select ng-model="listOrderBy">
            <option value="distanceToMapCenter" i18n:translate="">Distance to map center</option>
            <option value="distanceToZipcode" i18n:translate="">Distance to zipcode</option>
            <option value="companyName" i18n:translate="">Company name</option>
            <option value="companyZipcode" i18n:translate="">Zipcode</option>
          </select>
        </div>
        <div class="controls" ui-show="listOrderBy=='distanceToZipcode'"
             ui-hide="listOrderBy!='distanceToZipcode'">
          <select ng-model="user.country">
            <option value="DE">DE</option>
          </select>
          <input ng-model="user.zipcode" type="text" class="span2" value="47877"
                 placeholder="Zipcode" i18n:attributes="placeholder" />
        </div>
      </div>
      <div class="control-group span6">
        <label class="control-label" i18n:translate="">Show branches</label>
        <div class="controls" ng-repeat="branch in branches">
          <label class="checkbox">
            <input type="checkbox" ng-model="branch.visible"
                   ng-change="updateBranchesVisible()" /> {{branch.title}}
          </label>
        </div>
      </div>
    </form>

    <div class="row" ng-show="companies">
      <div class="span6 ng-cloak">
        <table class="table table-hover table-companies">
          <thead>
            <th i18n:translate="">Zipcode</th>
            <th i18n:translate="">City</th>
            <th i18n:translate="">Company</th>
            <th></th>
          </thead>
          <tbody ng-repeat="company in companies | orderBy:companyListOrder"
                 ng-show="company.visible()">
            <tr ng-hide="company.showDetails()"
                ng-click="company.showDetails(true)">
              <td>{{company.address.zipcode}}</td>
              <td>{{company.address.city}}</td>
              <td>{{company.title}}<br/>{{company.distance}}km</td>
              <td><a href=""><i class="icon-chevron-down"></i></a></td>
            </tr>
            <tr ng-show="company.showDetails()"
                ng-click="company.showDetails(false)">
              <td colspan="3">
                <h3>{{company.title}}</h3>
                <p ng-show="company.contact_person">
                  {{company.contact_person}}
                </p>
                <p>
                  {{company.address.street}}<br/>
                  {{company.address.country}}-{{company.address.zipcode}}
                  {{company.address.city}}
                </p>
                <table class="table table-condensed table-striped table-bordered">
                  <tr ng-show="company.telephone">
                    <td>Fon</td>
                    <td>{{company.telephone}}</td>
                  </tr>
                  <tr ng-show="company.facsimile">
                    <td>Fax</td>
                    <td>{{company.facsimile}}</td>
                  </tr>
                  <tr ng-show="company.email">
                    <td>Email</td>
                    <td>
                      <a href="mailto:{{company.email}}">{{company.email}}</a>
                    </td>
                  </tr>
                  <tr ng-show="company.url">
                    <td>Web</td>
                    <td>
                      <a href="{{company.url}}" target="_blank">
                        {{company.url}}
                      </a>
                    </td>
                  </tr>
                </table>
              </td>
              <td><a href=""><i class="icon-chevron-up"></i></a></td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="span6">
        <div id="map"><!--the map --></div>
        <div tal:condition="api.has_permission('add_company')">
          <p></p>
          <p>
            <a href="${request.resource_url(context, 'add_yp_company')}"
               class="btn btn-primary" i18n:translate="">
              Add your company to this listing
            </a>
          </p>
        </div>
      </div>
    </div>
  </article>
</html>
